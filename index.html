<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CSGOLuck | Best csgo casino</title>
    <link rel="icon" href="./dist/img/other/icon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Wix+Madefor+Display:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link href="./dist/css/hamburgers/hamburgers.min.css" rel="stylesheet" />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="./dist/css/style.min.css" />
    <script
      src="https://kit.fontawesome.com/bdb2f8ae99.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <nav class="nav above" data-aos="fade-in" data-aos-duration="500" data-aos-once="true">
      <ul class="nav__list">
        <li class="nav__list-item">
          <a
            class="nav__list-item-link nav__list-item-link--logo nav__list-item-link--color above"
            href="index.html"
          >
            <img
              class="nav__list-item-link-logo"
              src="./dist/img/other/icon.png"
              alt="csgoluck Logo"
            />
            <p class="nav__list-item-link-text">
              <span class="nav__list-item-link-text-green">CSGO</span>Luck
            </p>
          </a>
        </li>
        <li class="nav__list-item small">
          <p class="nav__list-item-balance">
            <img
              class="nav__list-item-balance-icon"
              src="./dist/img/other/coin.png"
              alt="Coin Icon"
            />
            <span class="nav__list-item-balance-amount" id="user-balance">100.00</span>
          </p>
        </li>
        <li class="nav__list-item small">
          <a class="nav__list-item-link nav__list-item-link--deposit" href="deposit.html">Deposit</a>
        </li>
        <!-- Add the Discord login button -->
        <li class="nav__list-item small">
          <button class="discord-login-btn" onclick="loginWithDiscord()">Login with Discord</button>
        </li>
      </ul>
    </nav>

    <script>
      const clientId = '1340701003523297320'; // Your Discord client ID
      const redirectUri = 'https://doyalikess.github.io/SatchelSpin2/index.html'; // Redirect URI set in the Discord Developer Portal

      // The URL to redirect users to Discord for OAuth2 login
      const discordOAuthUrl = `https://discord.com/oauth2/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&response_type=code&scope=identify`;

      function loginWithDiscord() {
        // Redirect to Discord OAuth2 login page
        window.location.href = discordOAuthUrl;
      }

      // After the user is redirected back to the site, we need to handle the OAuth2 response
      const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get('code');

      if (code) {
        // The user is logged in and we have the OAuth2 code
        console.log('Discord code:', code);

        // Make an API call to get the user data
        fetch(`https://discord.com/api/oauth2/token`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: new URLSearchParams({
            client_id: clientId,
            client_secret: 'E7ToLGdy63sNDD1HBFMHdDsKvABbXO5D', // Your Discord client secret
            code: code,
            grant_type: 'authorization_code',
            redirect_uri: redirectUri,
          })
        })
        .then(response => response.json())
        .then(data => {
          const accessToken = data.access_token;
          console.log('Access token:', accessToken);

          // Now use the access token to fetch the user data
          fetch('https://discord.com/api/v10/users/@me', {
            headers: {
              'Authorization': `Bearer ${accessToken}`
            }
          })
          .then(response => response.json())
          .then(userData => {
            console.log('User data:', userData);

            // Display the username in the UI
            document.getElementById('user-balance').textContent = `Welcome, ${userData.username}`;
          })
          .catch(err => {
            console.error('Error fetching user data:', err);
          });
        })
        .catch(err => {
          console.error('Error exchanging code for access token:', err);
        });
      }
    </script>
  </body>
</html>
